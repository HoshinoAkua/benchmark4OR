import json
from gurobipy import Model, GRB

# Transportation Problem with Evaporation Losses
# Problem type: LP
# Domain: water_resource_management
# Variant description: This variant considers evaporation losses during transportation. The amount of water that reaches each field is reduced by a certain percentage based on the distance between the reservoir and the field.

# Read data
with open('data.json', 'r') as f:
    data = json.load(f)

### Read parameters from data
reservoirs = data['reservoirs']  # the available amount of water in each reservoir
fields = data['fields']  # the required amount of water for each field
costs = data['costs']  # the transportation cost per unit of water from each reservoir to each field
evaporation_rates = data['evaporation_rates']  # the evaporation rate per unit distance from each reservoir to each field

### Get hyperparameters
R = len(reservoirs)  # number of reservoirs
F = len(fields)  # number of fields

# Create a new model
model = Model("Transportation Problem with Evaporation Losses")

### Add variables
# The amount of water transported from reservoir i to field j
x = model.addVars(R, F, vtype=GRB.CONTINUOUS, name="x")

### Set objective
# Minimize total transportation cost
model.setObjective(sum(costs[i][j] * x[i, j] for i in range(R) for j in range(F)), GRB.MINIMIZE)

### Add constraints
# The total amount of water transported from each reservoir cannot exceed its capacity
for i in range(R):
    model.addConstr(sum(x[i, j] for j in range(F)) <= reservoirs[i], name=f"ReservoirCapacity_{i}")

# The total amount of water received by each field must meet its requirement, considering evaporation losses
for j in range(F):
    model.addConstr(sum(x[i, j] * (1 - evaporation_rates[i][j]) for i in range(R)) >= fields[j], name=f"FieldRequirement_{j}")

# Save the model as a '.lp' file.
model.write('model.lp')